# 模板注册表规范（EMSimLab）

## 1. 目标
- 模板注册信息保持可读、可审查、可注释。
- 模板定义与汇总解耦，避免把所有模板堆在一个大文件里。
- 先保证 M1 链路稳定，再按同一规范扩展 M4/M5/A1。

## 2. 文件结构
```text
src/
  +templates/
    registry.m          % 注册表汇总入口
    getById.m           % 按 id 查询模板
    +defs/
      M1.m              % 单模板定义（每个模板一个文件）
```

## 3. 字段约定
每个模板定义函数（如 `templates.defs.M1`）返回一个 `struct`，至少包含：

- `id`：模板唯一通信信号（示例：`"M1"`）
- `title`：模板显示标题（中文）
- `group`：模板分组（用于模板树父节点）
- `engineKey`：引擎键（决定控制层/引擎分发）
- `schemaKey`：参数 schema 键（对应 `params.schema_get`）

## 4. 设计原则
- `+defs/*.m` 只写模板元数据，不写物理计算逻辑。
- `registry.m` 只做汇总，不写单模板细节。
- `getById.m` 统一做 id 查询与错误提示。
- 模板 id 统一大写（如 `M1`），避免大小写混用导致链路断裂。

## 5. 新增模板步骤
1. 新建 `src/+templates/+defs/<ID>.m`（例如 `M4.m`）。
2. 在 `src/+templates/registry.m` 中把该模板加入汇总数组。
3. 在 `src/+params/schema_get.m` 中补齐对应 `schemaKey`。
4. 在 UI 模板树与 `control.parseTemplateId` 链路中验证切换。
5. 在 `docs/CHANGELOG.md` 记录新增模板与字段变更。

## 6. 当前阶段说明
- 当前注册表先保留 `M1`，用于完成第一条迁移闭环。
- 后续模板按同一结构增量接入，避免一次性引入过多变量。

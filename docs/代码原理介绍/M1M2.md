## 1) 物理理论（核心只有两条）

### 洛伦兹力（磁场对运动电荷的力）

\[
\mathbf F = q\,\mathbf v \times \mathbf B
\]

在匀强磁场、且 \(\mathbf v \perp \mathbf B\) 时，力的大小：
\[
F = |q|vB
\]
方向永远**垂直于速度**。

### 牛顿第二定律 + 向心力

\[
m\mathbf a=\mathbf F
\]
因为磁力始终垂直速度，所以它只改变速度方向、不改变速度大小（磁力不做功）→ **速率 (|v|) 理想情况下恒定**。

把它与向心力 \(mv^2/r\) 对应起来：
\[
|q|vB=\frac{mv^2}{r}\Rightarrow r=\frac{mv}{|q|B}
\]
角速度、周期：
\[
\omega=\frac{qB}{m},\quad T=\frac{2\pi}{|\omega|}=\frac{2\pi m}{|q|B}
\]

---

## 2) 数学理论：为什么会出现"旋转矩阵"

把运动写成微分方程（二维平面、(B) 垂直纸面）：

\[
\frac{d\mathbf v}{dt}=\frac{qB}{m},J,\mathbf v
\]

这里 (J) 是一个"把向量旋转 90°"的矩阵（符号由 (B) 方向决定），典型形式像：

\[
J=\begin{bmatrix}0&-1\1&0\end{bmatrix}
\]

这是一个**常系数线性微分方程**，它的精确解是"矩阵指数"：
\[
\mathbf v(t+\Delta t)=e^{\omega J\Delta t}\mathbf v(t)
\]

关键点：因为 \(J^2=-I\)，所以指数可以化简成正弦余弦，最终变成你看到的**二维旋转矩阵**：

\[
R(\theta)=\begin{bmatrix}\cos\theta&-\sin\theta\\sin\theta&\cos\theta\end{bmatrix},
\quad \theta=\omega\Delta t
\]
\[
\mathbf v_{n+1}=R(\theta)\mathbf v_n
\]

所以"用矩阵"不是为了炫技，而是：**这就是这个物理系统的精确解（每个小步就是旋转一点角度）**。

---

## 3) 线性代数理论：为什么这种写法特别稳（|v|不漂）

旋转矩阵满足：
\[
R^TR=I
\]
这叫**正交矩阵**，它有个直接后果：**保持向量长度不变**
\[
|\mathbf v_{n+1}|=|R\mathbf v_n|=|\mathbf v_n|
\]

这正好对应教学要求：(|v|(t)) 应该是一条"水平线"。

---

## 4) 数值计算理论：为什么不用最朴素的欧拉法

如果你用显式欧拉：
\[
\mathbf v_{n+1}=\mathbf v_n+\mathbf a_n\Delta t
\]
它一般**不保能量/不保长度**，会让 (|v|) 慢慢漂移，轨迹从圆变成"螺旋/发散/收缩"。
而旋转更新是"结构保持"的：**天然守恒 (|v|)**。

这属于数值分析里常说的：

* 欧拉法：简单但能量漂移明显
* 旋转更新 / Boris 推进：更"物理一致"（守恒或近守恒）

---

## 5) M2 有界磁场还会多用到什么

M2（出界后直线）本质是**分段动力学 + 事件检测**：

* 场内：按上面的旋转更新（有加速度）
* 场外：\(B=0\Rightarrow a=0\Rightarrow\) 匀速直线

工程实现上通常还会用：

* **边界判定**（点在矩形内/外）
* **出界时刻的估计**（防止"一步跨出很远"）
  常见做法：二分法/线性插值去逼近"刚好碰边界"的时间点（这是数值计算里的根/事件定位思想）。

---

## 你需要掌握到什么程度

做这个项目其实不需要你系统学完"矩阵指数"。你只要记住：

1. 匀强磁场里：速度方向匀速转 → 所以每个时间步就是"把速度旋转一点点"。
2. 旋转矩阵是**保证 (|v|) 不漂移**的数值手段。
3. M2 只是多了"出界事件"，出界后切换成直线运动。

---

如果你愿意，我可以用**"从洛伦兹力到旋转矩阵"**写一段更贴近高中水平的推导（不使用矩阵指数，只用"速度分量微分方程 → 解出正弦余弦"），你会更有把握。

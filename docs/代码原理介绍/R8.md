# R5拓展（矩形线框 × 矩形磁场）情况 1/2/3：严谨推导 + 递推公式（定时器仿真可直接用）

> 目标：解决你提出的 **情况 1/2/3**（矩形线框进入矩形磁场）中  
> **磁通量 Φ(t)、电动势 ε(t)、电流 I(t)、安培力 F_mag(t)、功率 P(t)**  
> 以及（情况 2/3）**速度 v(t)、位移 x(t)** 的变化规律，并给出 **dtSim 递推公式**。  
> 默认高中最常用电路：**线框等效为纯电阻 R**（忽略自感/电容/辐射等）。

---

## 0. 模型与符号约定（统一框架）

### 0.1 几何与运动
- 线框为矩形，沿运动方向（x 方向）的长度：\(w\)  
- 垂直于运动方向（y 方向）的高度：\(h\)
- 磁场区域为矩形，沿 x 方向的范围：\([x_L,\,x_R]\)，宽度 \(W=x_R-x_L\)
- 磁场均匀且垂直纸面：\(\mathbf B = B\,\hat z\)（允许 \(B\) 带符号）
- 线框整体沿 \(+x\) 方向平移，取线框**前沿**（靠前的竖边）的 x 坐标为：
\[
x_f(t)
\]
则线框后沿（靠后的竖边）为：
\[
x_b(t) = x_f(t) - w
\]
速度定义：
\[
v(t)=\dot x_f(t)
\]

> 注：用 \(x_f\) 做状态变量最方便，因为进入/离开边界的判据都用“前沿/后沿是否跨过某边界”。

---

## 1. 核心几何量：重叠宽度 \(s(x_f)\)

线框在磁场中与磁场矩形的**重叠面积**可写为：
\[
A_{\text{overlap}}(x_f)=h\,s(x_f)
\]
其中 \(s(x_f)\) 是线框在 x 方向与磁场区间的**重叠宽度**：
- 线框在 x 上覆盖区间：\([x_b,\,x_f]=[x_f-w,\,x_f]\)
- 磁场在 x 上覆盖区间：\([x_L,\,x_R]\)

两区间的交长度就是：
\[
\boxed{
s(x_f)=\max\!\Bigl(0,\ \min(x_f,x_R)-\max(x_f-w,x_L)\Bigr)
}
\]
这条“max-min”写法对任意位置都成立（工程实现也最稳）。

---

## 2. 磁通量 Φ、电动势 ε、电流 I：从定律严格推出

### 2.1 磁通量
磁场均匀且垂直平面，故
\[
\boxed{
\Phi(x_f)=B\,A_{\text{overlap}}(x_f)=B\,h\,s(x_f)
}
\]

### 2.2 法拉第定律给电动势
\[
\varepsilon(t)=-\frac{d\Phi}{dt}
= -Bh\,\frac{ds}{dt}
\]
而 \(s\) 是 \(x_f\) 的函数，且 \(\dot x_f=v\)，链式法则：
\[
\frac{ds}{dt}=\frac{ds}{dx_f}\frac{dx_f}{dt}=s'(x_f)\,v
\]
得到
\[
\boxed{
\varepsilon(t)=-Bh\,s'(x_f)\,v(t)
}
\]
其中
\[
s'(x_f)=\frac{ds}{dx_f}
\]
是一个**分段常数**（典型情况下只取 \(+1,0,-1\)）。

### 2.3 纯电阻回路（高中常用）
忽略自感，回路电流：
\[
\boxed{
I(t)=\frac{\varepsilon(t)}{R}
}
\]

---

## 3. 安培力（阻力）与功率：用能量保证符号永远正确

线框中有感应电流时，磁场对线框做机械功率为 \(F_{\text{mag}}v\)，电阻耗散功率为 \(I^2R\)。能量守恒（电阻热来自机械做功）：
\[
F_{\text{mag}}v=-I^2R
\]
因此（当 \(v\neq 0\)）：
\[
\boxed{
F_{\text{mag}}=-\frac{I^2R}{v}
}
\]
再代入 \(I=\varepsilon/R\)：
\[
F_{\text{mag}}=-\frac{\varepsilon^2}{R\,v}
\]
再代入 \(\varepsilon=-Bh\,s'(x_f)\,v\)：
\[
\boxed{
F_{\text{mag}}=-\frac{B^2h^2}{R}\,s'(x_f)^2\,v
}
\]
注意 \(s'^2\ge0\)，因此 **\(F_{\text{mag}}\) 永远与速度反向**（阻碍运动），符合楞次定律。

功率输出（电阻热）：
\[
\boxed{
P(t)=I^2R=\frac{\varepsilon^2}{R}=-F_{\text{mag}}v
}
\]

---

## 4. “典型教学情形”分段（假设 \(w\le W\)，且线框从左侧进入）

下面为了给出最清晰的闭式解，我们采用最常见教学设定：

- 线框初始在磁场左侧：\(x_f(0)\le x_L\)
- \(w\le W\)（磁场宽于线框长度）
- 线框沿 \(+x\) 运动

此时 \(s(x_f)\) 与 \(s'(x_f)\) 分为 5 段：

| 区段 | 条件（用前沿 \(x_f\) 表示） | 重叠宽度 \(s\) | 导数 \(s'\) |
|---|---|---|---|
| 左侧未进入 | \(x_f\le x_L\) | \(0\) | \(0\) |
| 进入阶段 | \(x_L<x_f<x_L+w\) | \(x_f-x_L\) | \(+1\) |
| 完全在场内 | \(x_L+w\le x_f\le x_R\) | \(w\) | \(0\) |
| 离开阶段 | \(x_R<x_f<x_R+w\) | \(x_R+w-x_f\) | \(-1\) |
| 右侧完全离开 | \(x_f\ge x_R+w\) | \(0\) | \(0\) |

由此可立即得到：

- 进入阶段：\(\varepsilon=-Bh\,v\)，\(I=-\frac{Bh}{R}v\)，\(F_{\text{mag}}=-\frac{B^2h^2}{R}v\)
- 完全在场内：\(\varepsilon=0, I=0, F_{\text{mag}}=0\)
- 离开阶段：\(\varepsilon=+Bh\,v\)，\(I=+\frac{Bh}{R}v\)，\(F_{\text{mag}}=-\frac{B^2h^2}{R}v\)

> 重要：进入/离开时电动势符号相反（方向翻转），但阻力 \(F_{\text{mag}}\) 同号（都阻碍运动）。

---

# 情况 1：线框匀速进入且始终匀速（\(v=v_0\) 强制给定）

### 1.1 位移与分段时间（在 \(w\le W\) 下）
设前沿：
\[
x_f(t)=x_{f0}+v_0 t
\]
进入开始时刻：
\[
t_1=\frac{x_L-x_{f0}}{v_0}
\]
完全进入时刻：
\[
t_2=t_1+\frac{w}{v_0}
\]
开始离开时刻：
\[
t_3=t_1+\frac{W}{v_0}
\]
完全离开时刻：
\[
t_4=t_3+\frac{w}{v_0}
\]

### 1.2 磁通量 Φ(t)
- \(t<t_1\)：\(\Phi=0\)
- \(t_1\le t<t_2\)（进入）：\(s=v_0(t-t_1)\)
\[
\boxed{\Phi(t)=Bh\,v_0(t-t_1)}
\]
- \(t_2\le t\le t_3\)（全内）：
\[
\boxed{\Phi(t)=Bh\,w}
\]
- \(t_3<t\le t_4\)（离开）：\(s=w-v_0(t-t_3)\)
\[
\boxed{\Phi(t)=Bh\,[\,w-v_0(t-t_3)\,]}
\]
- \(t>t_4\)：\(\Phi=0\)

### 1.3 电动势、电流、安培力、功率（均为分段常量/零）
进入段（常量）：
\[
\boxed{\varepsilon=-Bh\,v_0},\quad
\boxed{I=-\frac{Bh}{R}v_0},\quad
\boxed{F_{\text{mag}}=-\frac{B^2h^2}{R}v_0},\quad
\boxed{P=\frac{B^2h^2}{R}v_0^2}
\]
全内段：
\[
\varepsilon=I=F_{\text{mag}}=P=0
\]
离开段（电动势与电流换号，阻力不变）：
\[
\boxed{\varepsilon=+Bh\,v_0},\quad
\boxed{I=+\frac{Bh}{R}v_0},\quad
\boxed{F_{\text{mag}}=-\frac{B^2h^2}{R}v_0},\quad
\boxed{P=\frac{B^2h^2}{R}v_0^2}
\]

> 若你“强制匀速”，那么必须存在外界驱动力 \(F_{\text{ext}}= -F_{\text{mag}}\) 来抵消阻力；
> 外界供能功率 \(P_{\text{ext}}=F_{\text{ext}}v_0=P\)。

---

# 情况 2：线框以初速度进入，之后只受电磁阻力（无外力）

## 2.1 进入/离开阶段动力学：一阶阻尼（指数衰减）

进入/离开时 \(s'^2=1\)，阻力：
\[
F_{\text{mag}}=-\frac{B^2h^2}{R}v
\]
牛顿第二定律（取 \(x\) 正向为运动方向）：
\[
m\dot v = F_{\text{mag}} = -\frac{B^2h^2}{R}v
\]
令
\[
k\equiv \frac{B^2h^2}{R},\quad \gamma\equiv \frac{k}{m}=\frac{B^2h^2}{mR},\quad \tau\equiv \frac{1}{\gamma}=\frac{mR}{B^2h^2}
\]
得到标准形式：
\[
\boxed{\dot v = -\gamma v}
\]

连续解（以某段起点 \(t=t_0\)，\(v(t_0)=v_0\)）：
\[
\boxed{
v(t)=v_0 e^{-\gamma (t-t_0)}
}
\]
位移（前沿）：
\[
x_f(t)=x_{f0}+\int_{t_0}^{t} v(\xi)\,d\xi
= x_{f0}+\frac{v_0}{\gamma}\Bigl(1-e^{-\gamma (t-t_0)}\Bigr)
\]
即
\[
\boxed{
x_f(t)=x_{f0}+v_0\tau\Bigl(1-e^{-(t-t_0)/\tau}\Bigr)
}
\]

## 2.2 进入能否“完全进入”的判据（很关键）
进入阶段需要前沿从 \(x_L\) 走到 \(x_L+w\)，所需位移为 \(w\)。

但指数段的最大位移（\(t\to\infty\)）是：
\[
\Delta x_{\max}=\frac{v_0}{\gamma}=v_0\tau
\]
因此完全进入的必要条件：
\[
\boxed{v_0\tau > w}
\]
若不满足，线框会在进入途中逐渐停下，最终 \(\varepsilon,I,F_{\text{mag}}\to 0\)。

## 2.3 进入/离开阶段的 **dtSim 递推公式（推荐直接用于 Engine）**
设单步仿真步长 \(\Delta t\)（即 dtSim），在进入/离开段：
\[
\boxed{
v_{n+1}=v_n\,e^{-\gamma\Delta t}
}
\]
\[
\boxed{
x_{f,n+1}=x_{f,n}+v_n\,\tau\Bigl(1-e^{-\gamma\Delta t}\Bigr)
}
\]
并输出：
\[
\Phi_n=Bh\,s(x_{f,n})
\]
\[
\varepsilon_n=-Bh\,s'(x_{f,n})\,v_n
\]
\[
I_n=\varepsilon_n/R
\]
\[
F_{\text{mag},n}=-k\,v_n\quad (k=B^2h^2/R)
\]
\[
P_n=I_n^2R=\varepsilon_n^2/R
\]
\[
a_n=\dot v(t_n)=-\gamma v_n\quad(\text{进入/离开段})
\]

## 2.4 “完全在场内”阶段（\(s'=0\)）：无感应、匀速滑行
当 \(x_f\in[x_L+w,\,x_R]\)：
\[
\varepsilon=I=F_{\text{mag}}=0
\Rightarrow
\dot v=0
\Rightarrow
v=\text{常量}
\]
递推：
\[
\boxed{v_{n+1}=v_n},\quad \boxed{x_{f,n+1}=x_{f,n}+v_n\Delta t},\quad a_n=0
\]

## 2.5 边界事件时间（可用于“精确跨界”，也可用二分）
若在指数段要精确求达到某个边界 \(x^*\) 的时间（必须满足 \(x^*-x_0 < v_0\tau\)）：
\[
x^*=x_0+v_0\tau\Bigl(1-e^{-(t^*-t_0)/\tau}\Bigr)
\]
解得
\[
\boxed{
t^*=t_0-\tau\ln\!\Bigl(1-\frac{x^*-x_0}{v_0\tau}\Bigr)
}
\]
工程上你也可以继续沿用“预测跨界→二分求根”的通用流程。

---

# 情况 3：线框受到恒力 \(F\)（始终作用），同时存在电磁阻力（进入/离开时才有）

情况 3 在每个区段的动力学不同：

- 进入/离开：有感应 → 存在阻力 \(-kv\)
- 全内/全外：无感应 → 只有恒力 \(F\)

下面给出两类区段的解析与递推。

---

## 3.1 进入/离开阶段（\(s'^2=1\)）：受恒力 + 线性阻力

动力学：
\[
m\dot v = F - kv
\quad,\quad k=\frac{B^2h^2}{R}
\]
写成标准一阶线性：
\[
\dot v=\frac{F}{m}-\gamma v
\quad,\quad \gamma=\frac{k}{m}
\]
稳态速度（终端速度）：
\[
v_\infty=\frac{F}{k}=\frac{FR}{B^2h^2}
\]
连续解（以段起点 \(t_0\)、初值 \(v_0\)）：
\[
\boxed{
v(t)=v_\infty+(v_0-v_\infty)e^{-\gamma(t-t_0)}
}
\]
位移：
\[
x_f(t)=x_{f0}+\int v dt
= x_{f0}+v_\infty(t-t_0)+(v_0-v_\infty)\tau\Bigl(1-e^{-(t-t_0)/\tau}\Bigr)
\]
即
\[
\boxed{
x_f(t)=x_{f0}+v_\infty\Delta t+(v_0-v_\infty)\tau(1-e^{-\Delta t/\tau})
}
\]
（上式中的 \(\Delta t=t-t_0\)）

### **dtSim 递推（进入/离开段）**
\[
\boxed{
v_{n+1}=v_\infty+(v_n-v_\infty)e^{-\gamma\Delta t}
}
\]
\[
\boxed{
x_{f,n+1}=x_{f,n}+v_\infty\Delta t+(v_n-v_\infty)\tau\Bigl(1-e^{-\gamma\Delta t}\Bigr)
}
\]
输出量仍按通式：
\[
\varepsilon_n=-Bh\,s'(x_{f,n})v_n,\quad I_n=\varepsilon_n/R
\]
\[
F_{\text{mag},n}=-kv_n,\quad P_n=\varepsilon_n^2/R
\]
加速度（进入/离开段）：
\[
\boxed{
a_n=\dot v(t_n)=\frac{F-kv_n}{m}=\frac{F}{m}-\gamma v_n
}
\]

---

## 3.2 完全在场内 / 完全在场外（\(s'=0\)）：只有恒力，匀加速

此时无感应：
\[
\varepsilon=I=F_{\text{mag}}=0
\]
动力学退化：
\[
m\dot v = F \Rightarrow a=\frac{F}{m}
\]
连续解：
\[
v(t)=v_0+\frac{F}{m}(t-t_0)
\]
\[
x_f(t)=x_{f0}+v_0(t-t_0)+\frac12\frac{F}{m}(t-t_0)^2
\]

### **dtSim 递推（全内/全外段）**
\[
\boxed{
a=\frac{F}{m}
}
\]
\[
\boxed{
v_{n+1}=v_n+a\Delta t
}
\]
\[
\boxed{
x_{f,n+1}=x_{f,n}+v_n\Delta t+\frac12 a\Delta t^2
}
\]
并输出 \(\varepsilon=I=F_{\text{mag}}=P=0\)，但仍要画 \(|v|(t),|a|(t)\)。

---

# 4. 仿真分段推进建议（与你现有 R2/R 系统同构）

## 4.1 运行时每个 tick 需要的几何判断（只依赖 \(x_f\)）
在 \(w\le W\) 的典型设定下，直接按 §4 表格判断区段即可：
- \(x_f\le x_L\)：外侧
- \(x_L<x_f<x_L+w\)：进入（\(s'=+1\)）
- \(x_L+w\le x_f\le x_R\)：全内（\(s'=0\)）
- \(x_R<x_f<x_R+w\)：离开（\(s'=-1\)）
- \(x_f\ge x_R+w\)：外侧

更通用的方式是用 §1 的 clamp 公式算 \(s(x_f)\)，并按区段推断 \(s'\)。

## 4.2 进入/离开段与全内段使用不同的“解析递推核”
- 进入/离开：
  - 情况2：指数核（\(\dot v=-\gamma v\)）
  - 情况3：带恒力的指数核（\(\dot v=F/m-\gamma v\)）
- 全内/全外：
  - 情况2：匀速核
  - 情况3：匀加速核（\(a=F/m\)）

## 4.3 事件（跨界）处理
若一个 dtSim 内可能跨越多个区段（例如从进入跨到全内），建议：
1) 先用当前区段的解析式预测 \(x_{f,n+1}\)
2) 若跨越边界，则在本步内求边界时刻 \(t^*\)（指数段可用对数闭式，匀加速段可解二次；或用二分）
3) 先推进到边界，再用剩余时间推进下一段

---

# 5. 输出量一览（满足教学硬性曲线）

每个时间点（或每步）可输出：
- 速度：\(|v|(t)=|v|\)（1D 时就是 \(v\) 的绝对值）
- 加速度：\(|a|(t)\)
- 磁通量：\(\Phi(t)=Bh\,s(x_f)\)
- 电动势：\(\varepsilon(t)=-Bh\,s'(x_f)\,v\)
- 电流：\(I(t)=\varepsilon/R\)
- 安培力（阻力）：\(F_{\text{mag}}(t)=-\dfrac{B^2h^2}{R}s'(x_f)^2 v\)
- 功率：\(P(t)=\varepsilon^2/R=I^2R\)

> 备注：若线框有 N 匝，\(\Phi\to N\Phi,\ \varepsilon\to N\varepsilon,\ I\to N\varepsilon/R\)，阻力 \(F_{\text{mag}}\propto N^2\)。

---

# 发布与日常开发协作

本文讲“日常开发怎么做、发布版怎么开、协作时怎么避免踩坑”。

快速跳转：

1. 上一页：`06_参数组件接口与新增组件流程.md`
2. 下一页：`08_FAQ_常见坑汇总.md`
3. 术语表：`GLOSSARY.md`

## 1. 开发入口与发布入口（分开看）

### 1.1 日常开发入口

优先：

1. `run.m`
2. `apps/MainApp.m`（直接 `app = MainApp`）

对应文件：

1. `run.m`
2. `apps/MainApp.m`

### 1.2 发布入口

发布版入口不是 `apps/MainApp.m`，而是 `boot.openReleaseApp()`。

对应文件：

1. `src/+boot/openReleaseApp.m`
2. `apps_release/README_放置MainApp_mlapp.txt`

约定（来自 `apps_release/README_放置MainApp_mlapp.txt`）：

1. `apps_release` 不加入 MATLAB Project Path。
2. 日常开发用 `apps/MainApp.m`。

## 2. UI 协作约定（当前项目实际做法）

当前路径体系：

1. `mlapp/*.mlapp`：可视化编辑源。
2. `m/Version/*.m`：导出快照。
3. `m/*_for_test.m`：当前接入主链路的组件代码。

这意味着：

1. 业务逻辑优先改 `src/`。
2. 参数组件接口优先维持稳定（`getPayload/setPayload/PayloadChanged`）。

## 3. 文档与代码的当前现实差异

已知差异：

1. `README.md` 有 `run_dev.m` 提示，但仓库当前是 `run.m`。

协作建议：

1. 以仓库实际文件为准。
2. 文档中的命令建议同步维护，避免新人按旧命令启动失败。

## 4. 分支协作建议（轻量）

当前仓库未提供 `CONTRIBUTING.md`，建议先采用以下最小规则：

1. 业务改动与文档改动尽量分开提交。
2. 新增模板至少包含：
   1. 模板定义
   2. 注册表更新
   3. 参数 schema/validate 对应变更
   4. 参数组件映射更新（如需要）
3. 改渲染时尽量不改引擎分发结构。

## 5. 不同目录该不该改（快速判断）

可以常改：

1. `src/`（核心业务）
2. `m/*_for_test.m`（参数组件）
3. `docs/参考手册/`（新手文档）

谨慎改：

1. `mlapp/`（可能覆盖 UI 结构）
2. `m/Version/`（快照目录，通常不当主线代码）

通常不改：

1. `resources/project/`（MATLAB 元数据）
2. `sandbox/`（临时实验目录）

## 6. 你的当前约束如何落在协作流程中

基于当前约束，建议执行：

1. `R2LC` 先作为模板占位，不进入业务实现。
2. `docs/代码原理介绍/` 只读，不改。
3. 新文档全部放在 `docs/参考手册/`。
4. 图片只留占位，后续人工补图。

## 7. 发布前最小人工检查

不依赖 smoke 测试的情况下，可做：

1. 启动 `MainApp` 成功。
2. 模板树可切换，参数组件能跟随切换。
3. `运行/暂停/重置` 按钮行为正常。
4. 日志区可见关键事件，无明显错误刷屏。

## 8. 常见坑

1. 把 `apps_release` 当开发目录改，后续难合并回主线。
2. 只改 `mlapp` 不改 `m/*_for_test.m`，导致运行链路不一致。
3. 误删 `ensureDevPaths` 的路径注入，导致组件类找不到。
4. 把临时实验代码直接塞进 `src` 主链路，后续难回滚。

图示占位：

1. [占位] 开发流与发布流双轨图
2. [占位] `mlapp -> Version -> *_for_test` 同步示意图
